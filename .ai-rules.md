# AI Agent Rules ‚Äì Sicherheitsdienst-Tool

> **F√ºr alle KI-Assistenten (Claude Code, Codex, etc.)**
> Diese Regeln gelten projekt-weit und m√ºssen **strikt** befolgt werden.

---

## üõ°Ô∏è KRITISCHE SYSTEM-SCHUTZREGELN

### ‚ùå ABSOLUT VERBOTEN

**Diese Aktionen d√ºrfen NIEMALS ausgef√ºhrt werden:**

- `/etc/fstab` oder andere Boot-Konfigurationen √§ndern
- `/etc/passwd`, `/etc/shadow`, `/etc/sudoers` modifizieren
- SSH-Konfiguration (`/etc/ssh/sshd_config`) √§ndern
- Firewall deaktivieren (`ufw disable`, `iptables -F`)
- SSH-Dienst stoppen (`systemctl stop sshd`)
- Destruktive Befehle: `rm -rf /`, `mkfs`, `fdisk`, `parted`, `dd`
- System-Partitionen oder `/boot` modifizieren

### ‚ö†Ô∏è VOR AUSF√úHRUNG FRAGEN

**Diese Aktionen erfordern IMMER explizite Best√§tigung:**

- Dateien in `/etc/` lesen oder √§ndern (au√üer `/etc/docker/`)
- System-Packages installieren/entfernen (`apt install/remove`)
- Systemd-Dienste starten/stoppen/neu laden
- Server-Neustart (`reboot`, `shutdown`)
- Git-Push (nur nach erfolgreichen Tests)

### ‚úÖ ERLAUBT (ohne Nachfrage)

- Alle Dateien in `/home/cmdshadow/project/`
- Docker-Befehle: `docker`, `docker-compose`, `docker build`
- Git-Operationen (au√üer Push)
- NPM/Node/Prisma-Befehle
- Tests, Lint, Build ausf√ºhren

---

## üìã PROJEKTSPEZIFISCHE REGELN

### Tech-Stack & Konventionen

**Stack:**
- Node.js ‚â• 20, TypeScript, Express, Prisma, PostgreSQL
- Frontend: Vite/React
- Container: Docker Compose
- Tests: Jest (Unit/Integration)

**Code-Stil:**
- ESLint + Prettier sind konfiguriert
- Line Endings: LF (`.gitattributes` beachten)
- Commits im Imperativ: `feat:`, `fix:`, `chore:`
- Keine massiven Format-Deltas auf einmal

**Qualit√§t:**
- Tests m√ºssen gr√ºn sein vor jedem Push
- Lint/Format vor Commit ausf√ºhren
- API-Contracts: `docs/openapi.yaml` muss aktuell bleiben

### Arbeitsweise (IMMER befolgen!)

1. **Vor jeder √Ñnderung:**
   - Plan erstellen (welche Dateien, welche Befehle)
   - **UNIFIED DIFF** aller √Ñnderungen zeigen
   - **Auf Freigabe warten** ‚ö†Ô∏è

2. **Nach Freigabe:**
   - Befehle ausf√ºhren
   - Tests laufen lassen (`npm test`)
   - Lint pr√ºfen (`npm run lint`)
   - Docs aktualisieren wenn n√∂tig
   - Commit: `feat|fix|chore: ...`

3. **Keine √úberraschungen:**
   - Bei Unklarheiten: **R√ºckfragen** statt raten
   - Keine stillen √Ñnderungen an System-Configs
   - README/CHANGELOG aktuell halten

### Source of Truth

**Immer zuerst konsultieren:**
- `docs/STRUCTURE.md` ‚Äì Code & Doku-√úberblick
- `docs/KONZEPT.md` ‚Äì Fachliche Leitplanken
- `docs/openapi.yaml` ‚Äì API-Spezifikation
- `AGENT_INSTRUCTIONS.md` ‚Äì Detaillierte Arbeitsanweisungen

### Docker & Compose

- Dev-Stack: `docker-compose.dev.yml`
- Postgres: `admin/admin123`, DB `sicherheitsdienst_db`
- Migrations: Laufen automatisch beim Start (`prisma migrate deploy`)
- Seeds: Kontrolliert via `SEED_ON_START` (Dev: `true`)

### Prisma & Datenbank

- Migrations **nur** via `npx prisma migrate dev`
- Nie manuell in DB-Schema eingreifen
- Seeds in `utils/seedHelpers.ts` nutzen
- Bei Schema-√Ñnderungen: OpenAPI aktualisieren

### Security & RBAC

- JWT-Auth: Access + Refresh Tokens
- Rollen: ADMIN, MANAGER, DISPATCHER, EMPLOYEE
- Rate-Limits beachten (Login, API, Schichten)
- Audit-Log f√ºr kritische Aktionen

---

## üîê SPEZIELLE HINWEISE

### Claude Code Sessions

**Session-Start Checklist:**
1. Ziele f√ºr heute best√§tigen (max. 3 Tasks)
2. `ROADMAP.md` aktualisieren wenn n√∂tig
3. Diff zeigen ‚Üí Freigabe abwarten
4. Nach √Ñnderungen: Tests + Lint ausf√ºhren

**Vor jedem Commit:**
```bash
npm run lint
npm test
npm run build  # Wenn TypeScript-√Ñnderungen