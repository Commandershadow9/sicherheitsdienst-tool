# Release v2025-09-09

## Kurz-Zusammenfassung
- Spec-Alignment: OpenAPI-Fehlerschema vereinheitlicht, Beispiele aktualisiert; 405-Komponente ergänzt.
- Stabilität: Prisma-Singleton; Rate-Limit für Login/Refresh; Request-ID in Logs; einfache Request-Zähler in /stats.
- Incidents E2E: CRUD + Listen/Filter + CSV/XLSX; RBAC (ADMIN/MANAGER schreiben, AUTH lesen); Zod-Validation; Tests; OpenAPI angepasst.
- Hardening: 405-Handling auf allen Routern inkl. Allow-Header; Negative RBAC-Tests (Incidents anonymous/employee) und TimeTracking-Warnungen.
- Notifications: E-Mail Retry (1x) mit Tests; 5xx-Fehlerbeispiele für Push/E-Mail in OpenAPI.
- Operability: README-Runbook (Start/Stop, Health/Stats, Logs/Request-ID, Rate-Limits, SMTP/Retry, ENV-Matrix).

## Details
### Added
- feat(openapi): Fehler-Response-Shape harmonisiert (`success:false`, `code`, `message`, `errors?`) und Beispiele in `#/components/responses/*` aktualisiert.
- feat(auth): Rate-Limit für `POST /auth/login` und `POST /auth/refresh` (ENV `AUTH_RATE_LIMIT_*`) inkl. `Retry-After`/`RateLimit-*` Headern.
- feat(observability): Request-ID Middleware (`X-Request-ID`) + Logs; Request-Zähler (`requestsTotal`, `responses4xx`, `responses5xx`) in `/stats`.
- feat(incidents): E2E-Implementierung (CRUD, List/Filter, CSV/XLSX Exporte, RBAC ADMIN/MANAGER schreiben, AUTH lesen) inkl. Tests und OpenAPI.
- feat(email): Einfacher Retry (1x) bei transienten SMTP-Fehlern (`SMTP_RETRY_MAX`, `SMTP_RETRY_DELAY_MS`), Tests.
- docs(runbook): Operations-/Runbook in README.

### Changed
- refactor(prisma): Zentrales Prisma-Client-Singleton (`backend/src/utils/prisma.ts`).
- docs(openapi): Incidents-List-Antwort vereinheitlicht; CSV/XLSX Accept für Incidents; 405 `MethodNotAllowed`-Komponente.
- tests: RBAC negative für Incidents; TimeTracking-Warnungen (Rest <11h, Dauer >10h/>12h).
- auth/jwt: Optional `JWT_ISSUER`/`JWT_AUDIENCE` für Signatur/Verifikation (ENV).

### Docs/CI
- ROADMAP/CHANGELOG/PR-Beschreibung aktualisiert.
- Contract-Tests Leitfaden (`docs/testing/contract-tests.md`) + optionaler CI-Workflow (`.github/workflows/contract-tests.yml`).

## Migrations/Compat
- Keine DB-Migration notwendig für diesen Release.
- Achtung: Clients sollten das Fehler-Response-Shape `{ success:false, code, message, errors? }` berücksichtigen.

## Danksagung
- Enthält Arbeiten der Planungs-Phasen 1–5 (2025-09-09).

