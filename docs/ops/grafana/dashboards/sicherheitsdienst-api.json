{
  "title": "Sicherheitsdienst API",
  "schemaVersion": 39,
  "version": 1,
  "refresh": "30s",
  "panels": [
    {
      "type": "stat",
      "title": "Requests Total",
      "gridPos": {"x":0, "y":0, "w":6, "h":4},
      "targets": [{"expr": "app_requests_total"}]
    },
    {
      "type": "stat",
      "title": "4xx Total",
      "gridPos": {"x":6, "y":0, "w":6, "h":4},
      "targets": [{"expr": "app_responses_4xx_total"}]
    },
    {
      "type": "stat",
      "title": "5xx Total",
      "gridPos": {"x":12, "y":0, "w":6, "h":4},
      "targets": [{"expr": "app_responses_5xx_total"}]
    },
    {
      "type": "graph",
      "title": "Auth 429 (IP) 5m increase",
      "gridPos": {"x":0, "y":4, "w":12, "h":8},
      "targets": [{"expr": "increase(app_auth_ratelimit_ip_429_total[5m])"}]
    },
    {
      "type": "graph",
      "title": "Auth 429 (User) 5m increase",
      "gridPos": {"x":12, "y":4, "w":12, "h":8},
      "targets": [{"expr": "increase(app_auth_ratelimit_user_429_total[5m])"}]
    },
    {
      "type": "heatmap",
      "title": "HTTP Latency (s) Heatmap",
      "gridPos": {"x":0, "y":12, "w":24, "h":9},
      "targets": [{"expr": "histogram_quantile(0.95, sum by (le) (rate(http_request_duration_seconds_bucket[5m])))"}],
      "options": {"legend": {"show": true}}
    },
    {
      "type": "graph",
      "title": "Requests rate by status (5m)",
      "gridPos": {"x":0, "y":21, "w":24, "h":8},
      "targets": [{"expr": "sum by (status_code) (rate(http_requests_total[5m]))"}]
    },
    {
      "type": "graph",
      "title": "Requests rate by route+status (5m)",
      "gridPos": {"x":0, "y":29, "w":24, "h":8},
      "targets": [{"expr": "sum by (route,status_code) (rate(http_requests_total[5m]))"}],
      "options": {"legend": {"show": true}}
    },
    {
      "type": "graph",
      "title": "Top 10 routes by request rate (5m)",
      "gridPos": {"x":0, "y":37, "w":12, "h":8},
      "targets": [{"expr": "topk(10, sum by (route) (rate(http_requests_total[5m])))"}]
    },
    {
      "type": "graph",
      "title": "Top 10 routes by p95 latency (5m)",
      "gridPos": {"x":12, "y":37, "w":12, "h":8},
      "targets": [{"expr": "topk(10, histogram_quantile(0.95, sum by (route, le) (rate(http_request_duration_seconds_bucket[5m]))))"}]
    }
  ]
}
