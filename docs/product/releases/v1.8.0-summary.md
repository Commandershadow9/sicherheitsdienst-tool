# Release v1.8.0 - Zusammenfassung

**Release-Datum**: 2025-10-05
**GitHub Release**: https://github.com/Commandershadow9/sicherheitsdienst-tool/releases/tag/v1.8.0
**Status**: âœ… Released & Deployed

## ðŸŽ¯ GroÃŸer Meilenstein erreicht!

v1.8.0 ist der bisher grÃ¶ÃŸte Release seit v1.0.0 und bringt das **Intelligente Replacement System** - ein KI-basiertes Scoring-System fÃ¼r optimale Mitarbeiter-Empfehlungen.

### Was ist neu?

#### 1. Intelligentes Scoring-System (Backend)
- **5 Scoring-Algorithmen** mit 31 Unit-Tests (alle âœ“):
  - Workload-Score (70-90% Auslastung = optimal)
  - Compliance-Score (ArbZG Â§3: 48h/Woche, Â§5: 11h Ruhezeit)
  - Fairness-Score (Team-Durchschnitts-Vergleich)
  - Preference-Score (Mitarbeiter-PrÃ¤ferenzen-Match)
  - Total-Score (Gewichtung: 40% Compliance, 30% PrÃ¤ferenz, 20% Fairness, 10% Workload)

#### 2. Neue Datenmodelle (Prisma)
- `EmployeePreferences` - Schicht-/Objekt-/Arbeitsrhythmus-PrÃ¤ferenzen
- `EmployeeWorkload` - Auslastung, Nachtschichten, Compliance-Tracking
- `ComplianceViolation` - ArbZG-VerstÃ¶ÃŸe mit Severity-Level (WARNING/ERROR/CRITICAL)

#### 3. Neue UI-Komponenten (Frontend)
- `ScoreRing` - SVG-Kreis-Chart (0-100 Punkte) mit Farb-Kodierung
- `MetricBadge` - Icon + Label + Wert mit Status-Farben
- `WarningBadge` - Compliance-Warnungen (Info/Warning/Error)
- `ReplacementCandidatesModalV2` - Komplett neues Modal mit Scoring-Anzeige

#### 4. Visuelle Bewertung
- ðŸŸ¢ **OPTIMAL** (85-100): Perfekter Match, keine Probleme
- ðŸŸ¡ **GOOD** (70-84): Gute Wahl mit kleineren EinschrÃ¤nkungen
- ðŸŸ  **ACCEPTABLE** (50-69): Akzeptabel, aber nicht ideal
- ðŸ”´ **NOT_RECOMMENDED** (<50): Kritische Compliance-VerstÃ¶ÃŸe

## ðŸ› Kritischer Bugfix: Login-Problem

**Problem**: Nach v1.8.0 Implementierung kein Login mehr mÃ¶glich
**Root Cause**: Backend-Port-Wechsel (3000â†’3001) + Vite .env-Caching + Docker-Netzwerk-Issues

**LÃ¶sung**:
1. Backend vollstÃ¤ndig zu Docker migriert (Container: `sicherheitsdienst-api`)
2. DATABASE_URL: `localhost` â†’ `db:5432` (Docker-Service-Name)
3. Backend hÃ¶rt auf `0.0.0.0` (externe Erreichbarkeit)
4. CORS fÃ¼r externe IP konfiguriert (`http://37.114.53.56:5173`)
5. `VITE_API_BASE_URL` auf Port 3001 aktualisiert
6. Frontend-Container neu erstellt mit `--env-file .env`

**Neue Dokumentation**: `docs/TROUBLESHOOTING_LOGIN.md` mit kompletter Diagnose-Anleitung

## ðŸ“Š Statistiken

- **56 Dateien geÃ¤ndert**: 8463 Zeilen hinzugefÃ¼gt, 403 gelÃ¶scht
- **31 Unit-Tests**: Alle âœ“ (Scoring-Algorithmen)
- **3 Prisma Migrations**: Neue Models + Bugfixes
- **3 neue UI-Komponenten**: ScoreRing, MetricBadge, WarningBadge
- **5 Dashboard-Hooks**: State-Management vereinfacht
- **4 Test-Kandidaten**: OPTIMAL, GOOD, ACCEPTABLE, NOT_RECOMMENDED

## ðŸ“š Neue Dokumentation

### Feature-Specs
- `docs/FEATURE_INTELLIGENT_REPLACEMENT.md` - Komplette Spec mit Algorithmen-Details
- `docs/FEATURE_DASHBOARD.md` - Manager-Dashboard Spec

### Troubleshooting
- `docs/TROUBLESHOOTING_LOGIN.md` - Login-Problem Diagnose & LÃ¶sungen

### Seeds & Testing
- `backend/prisma/seeds/README.md` - Seed-Anleitung fÃ¼r v1.8.0
- `backend/prisma/seeds/intelligent-replacement-v1.8.0.ts` - Test-Kandidaten
- `backend/prisma/seeds/test-absences-v1.6.0.ts` - Dashboard-Testdaten

### Session Notes
- `docs/SESSION_NOTES.md` - Entwicklungs-Notizen
- `docs/releases/bugfix-2025-10-04.md` - Bugfix-Session Details

## âš ï¸ Breaking Changes

1. **Backend Port**: 3000 â†’ 3001 (Docker-Compose-Default)
2. **Frontend API-URL**: Muss explizit auf Port 3001 gesetzt werden
3. **Testdaten**: Nach Docker-Migration mÃ¼ssen Seeds neu ausgefÃ¼hrt werden

## ðŸ”„ Migration Guide

### FÃ¼r Entwickler

1. **Backend neu bauen**:
   ```bash
   docker compose build api
   docker compose up -d api
   ```

2. **Datenbank-Migration**:
   ```bash
   docker compose exec api npx prisma migrate deploy
   ```

3. **Seed neu laden**:
   ```bash
   docker compose exec api npm run seed
   ```

4. **Frontend .env prÃ¼fen**:
   ```bash
   # frontend/.env
   VITE_API_BASE_URL=http://37.114.53.56:3001  # PORT 3001!
   ```

5. **Frontend-Container neu erstellen**:
   ```bash
   docker stop project-web-1 && docker rm project-web-1
   docker run -d --name project-web-1 -p 5173:5173 \
     -v $(pwd)/frontend:/web -w /web --env-file frontend/.env \
     node:20 sh -c "npm install && npx vite --host 0.0.0.0 --port 5173"
   ```

### FÃ¼r Produktiv-Deployment

1. **Git Pull**:
   ```bash
   git pull origin main
   git checkout v1.8.0
   ```

2. **Environment Variables prÃ¼fen**:
   ```bash
   # .env (Root)
   DATABASE_URL=postgresql://admin:admin123@db:5432/sicherheitsdienst_db?schema=public
   CORS_ORIGIN=http://your-domain.com:5173

   # frontend/.env
   VITE_API_BASE_URL=http://your-domain.com:3001
   ```

3. **Services neu starten**:
   ```bash
   docker compose down
   docker compose build --no-cache
   docker compose up -d
   ```

4. **Migration & Seeds**:
   ```bash
   docker compose exec api npx prisma migrate deploy
   docker compose exec api npm run seed  # Basis-Seeds
   ```

## ðŸš€ NÃ¤chste Schritte (v1.9.0)

### Urgent (heute Abend testen)
- [ ] Testdaten wiederherstellen (Seeds in Docker ausfÃ¼hren)
- [ ] Dashboard testen: Alle 4 Test-Kandidaten sichtbar?
- [ ] Ersatz-Mitarbeiter-Scoring testen: Farben korrekt?
- [ ] Metriken-Anzeige testen: Auslastung, Ruhezeit, Nachtschichten
- [ ] E2E-Test: Kompletter Workflow (Abwesenheit â†’ Ersatz finden â†’ Zuweisen)

### Mittelfristig
- [ ] Integration-Tests fÃ¼r v2 API-Endpoint
- [ ] Performance-Test: Scoring < 500ms
- [ ] Mitarbeiter-PrÃ¤ferenzen-Editor UI (`/employees/:id/preferences`)
- [ ] Workload-Dashboard fÃ¼r Mitarbeiter (`/employees/:id/workload`)
- [ ] Team-Fairness-Ãœbersicht (`/team/fairness`)

### Langfristig (v2.0)
- [ ] Cron-Jobs fÃ¼r automatische Workload-Berechnung
- [ ] Predictive Scheduling (ML-Modell)
- [ ] Automatische Zuweisung (mit Opt-In)
- [ ] Learning from Feedback

## ðŸŽ“ Lessons Learned

### Was gut lief
1. **Systematisches Vorgehen**: Phasen 2a â†’ 2b â†’ 2c funktionierte perfekt
2. **Test-First**: 31 Unit-Tests vor Frontend-Implementierung = stabiles System
3. **Dokumentation**: Feature-Spec half enorm bei Implementierung
4. **Refactoring**: Dashboard-Refactoring (v1.7.1) war die richtige Entscheidung

### Was schwierig war
1. **Docker-Netzwerk**: Backend-Migration verursachte Login-Problem (3h Debugging)
2. **Vite .env-Caching**: Frontend-Container musste NEU ERSTELLT werden (nicht nur restart)
3. **Seed-Daten verloren**: Nach Docker-Migration mÃ¼ssen alle Seeds neu gelaufen werden

### Verbesserungen fÃ¼r nÃ¤chstes Mal
1. **Backup vor Infrastruktur-Ã„nderungen**: Testdaten sichern
2. **Docker-Compose dokumentieren**: Klarere .env-Hierarchie (Root vs. Service)
3. **Vite-Besonderheiten**: .env wird nur beim Container-CREATE geladen

## ðŸ‘¨â€ðŸ’» Entwicklungszeit

- **Phase 2a (Datenmodell)**: ~2h
- **Phase 2b (Backend Scoring)**: ~4h (inkl. 31 Tests)
- **Phase 2c (Frontend UI)**: ~3h
- **Phase 2d (Login-Bugfix)**: ~3h (Docker-Migration + Debugging)
- **Dokumentation & Release**: ~2h
- **GESAMT**: ~14h

## ðŸ™ Credits

Entwickelt mit **[Claude Code](https://claude.com/claude-code)** von Anthropic
Co-Authored-By: Claude <noreply@anthropic.com>

---

**Status**: âœ… Released
**NÃ¤chster Meilenstein**: v1.9.0 (Mitarbeiter-PrÃ¤ferenzen-Editor)
**Kontakt**: GitHub Issues fÃ¼r Bug-Reports & Feature-Requests
